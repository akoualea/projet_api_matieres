# ==========================================================
# Fichier render.yaml - Version DÉFINITIVE et OFFICIELLE
# ==========================================================

services:
  # 1. Notre service de base de données PostgreSQL
  # Le type est 'private' pour un service qui n'est pas directement exposé sur le web
  - type: pserv
    name: bdd-matieres
    # On spécifie l'environnement de la base de données
    env: postgres
    plan: free # Le plan gratuit

  # 2. Notre application web FastAPI
  - type: web
    name: projet-api-matieres
    env: python
    plan: free
    # Commande pour installer les dépendances
    buildCommand: "pip install -r requirements.txt"
    # Commande pour démarrer le serveur de production Gunicorn
    startCommand: "gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker"
    # Définition des variables d'environnement
    envVars:
      - key: PYTHON_VERSION
        value: "3.11"
      - key: DATABASE_URL
        # On récupère l'URL de connexion depuis le service de base de données
        fromService:
          type: pserv
          name: bdd-matieres
          property: connectionString